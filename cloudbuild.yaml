steps:
  # 1Ô∏è‚É£ Build the Docker Image
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'us-central1-docker.pkg.dev/deft-station-448022-u5/saquib-100949697/app:$COMMIT_SHA', '.']

  # 2Ô∏è‚É£ Push the Image to Artifact Registry
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'us-central1-docker.pkg.dev/deft-station-448022-u5/saquib-100949697/app:$COMMIT_SHA']

  # 3Ô∏è‚É£ Deploy to Cloud Run using Google Cloud SDK (THIS IS THE NEW STEP üöÄ)
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'  # ‚úÖ Uses Cloud SDK container
    entrypoint: 'gcloud'  # ‚úÖ Specifies entrypoint for gcloud CLI
    args:
      - 'run'
      - 'deploy'
      - 'saquib-100949697-service'  # ‚úÖ Your Cloud Run service name
      - '--image=us-central1-docker.pkg.dev/deft-station-448022-u5/saquib-100949697/app:$COMMIT_SHA'
      - '--region=us-central1'  # ‚úÖ Ensure this matches your deployment region
      - '--platform=managed'  # ‚úÖ Use Google-managed Cloud Run
      - '--allow-unauthenticated'  # ‚úÖ Publicly accessible service

options:
  logging: CLOUD_LOGGING_ONLY  # ‚úÖ Sends logs to Cloud Logging
